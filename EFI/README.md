# Hackintosh

This is the EFI folder for **OpenCore 0.6.9** with **Big Sur 11.3.1** for my **MacPro7,1 (2019)** Hackintosh build.

## Usage

Use [git repo](https://github.com/elieserme/efi/) to download the **EFI** folder 

```bash
git clone git@github.com:elieserme/efi.git EFI
```

Use [ProperTree](https://github.com/corpnewt/ProperTree) to edit the **config.plist** file and change **PlatformInfo** values to your own machine:
- **MLB**, **SystemSerialNumber** and **SystemUUID** can be generated by [GenSMBIOS utility](https://github.com/corpnewt/GenSMBIOS);
- **ROM** is the Mac address of the **en0** network adapter _(on Gigabyte z370N WIFI 1.0 is the Intel i219v gigabit port)_. Use the **Network Settings > Advanced > Hardware** panel to copy the Mac address _(only numbers and letters, without the : chars)_;
- included **USBPorts.kext** with USB mapping _(for the Gigabyte z370N WiFi 1.0 USB 2 and 3 ports, but the USB type C is disabled)_. It's a good starting point if you wish to remap the USB ports for your needs or just use it as is;
- included **CPUFriendDataProvider.kext** to make **CPU power management** work for Cofee Lake i7 8700 8th generation Intel CPU _(because original MacPro uses Intel Xeon CPU's)_.


Please read the **OpenCore Guide** to make any changes if you require different settings.

## Hardware

This is the shopping list of my build _(please remind that is a 2019 machine)_:

- **CPU:** [Intel i7 8700 ](https://www.intel.com.br/content/www/br/pt/products/processors/core/core-vpro/i7-8700.html) 8th generation 6 cores and 12 threads 3,2GHz with Turbo Boost up to 4,6GHz
- **Motherboard:** [Gigabyte Z370N WiFi 1.0 ](https://www.gigabyte.com/br/Motherboard/Z370N-WIFI-rev-10#kf) Mini ITX
- **RAM:** [G.SKILL 32GB ](https://www.gskill.com/product/165/326/1562838932/F4-3200C16D-32GTZN-Overview) DDR4 3200MHz F4-3200C16D-32GTZN
- **SSD:** [Samsung EVO 970 Plus ](https://www.samsung.com/semiconductor/minisite/ssd/product/consumer/970evoplus/) 250GB PCIe NVMe
- **Power Supply:** [Corsair CX550 Bronze ](https://www.corsair.com/br/pt/Categorias/Produtos/Unidades-de-fonte-de-alimentação/cx-series-config/p/CP-9020121-WW) 550W Unit
- **GPU:** [Gigabyte Radeon RX 590 8GB 1.0](https://www.gigabyte.com/br/Graphics-Card/GV-RX590GAMING-8GD-rev-10#kf) Dedicated Video Card
- **Wireless:** [BCM94360NG ](http://en.fenvi.com/en/download_zx.php) Bluetooth and WiFI replacement card
- **Case:** [XIGMATEK Nebula C ](https://www.xigmatek.com/product_detail.php?item=63) Mini ITX

## Why use MacPro7,1 (2019) model?

- Most **future proof and upgradeable** Intel Mac _(2019 launch and possible the last Intel MacPro forever)_
- **AMD Dedicated GPU** for best performance
- **h264** and **h265** video **encoding** and **decoding** at maximum speed
- Full DRM support for **Netflix**, **PrimeVideo** and **Apple TV+** even in Safari
- Note that **Sidecar** may not work because **this hack do not have T2 chip**

## Gigabyte Z370N WiFi BIOS F14b

- **Load optimised defaults**
- MIT &gt; Advanced Memory Settings &gt; XMP &gt; **Profile 1**
- SmartFan &gt; Fan Control Mode &gt; **PWM**
- SmartFan &gt; Fan Stop &gt; **ENABLED**
- BIOS &gt; CSM Support &gt; **DISABLED**
- BIOS &gt; Windows 8/10 Features &gt; **Windows 8/10 WHQL**
- Peripherals &gt; Above 4G Decoding &gt; **ENABLED**
- Peripherals &gt; Re-Size Bar &gt; **DISABLED**
- Peripherals &gt; Intel PTT &gt; **ENABLED**
- Peripherals &gt; SGX &gt; **Software Controlled**
- Peripherals &gt; Trusted Computing &gt; **ENABLED**
- Peripherals &gt; USB Config &gt; Legacy &gt; **DISABLED**
- Peripherals &gt; USB Config &gt; XHCI Handoff &gt; **ENABLED**
- Chipset &gt; VT-d &gt; **DISABLED**
- Chipset &gt; Internal Graphics &gt; **DISABLED** 
- Chipset &gt; Wake On Lan &gt; **DISABLED** _(disable on adapters too)_
- Power &gt; ErP &gt; **ENABLED**
- Save and restart

## Windows 10

- Must be **installed first** in it's own disk
- Need patch registry for **time sync** with MacOS, run **regedit as Administrator** and go to HKEY_LOCAL_MACHINE &gt; SYSTEM &gt; CURRENTCONTROLSET &gt; CONTROL &gt; TIMEZONEINFORMATION and add the property **RealTimeIsUniversal** with value **DWORD=1** _(if you don't plan to install BootCamp drivers)_
- Other option is install **BootCamp** drivers with [Brigadier](https://github.com/timsutton/brigadier) utility after MacOS installed _(use this option if you plan to use Apple Magic Keyboard and Trackpad)_
```bash
git clone https://github.com/timsutton/brigadier
cd brigadier
brigadier -m MacPro7,1 -i
```

## MacOS 11 Big Sur

- Can be direct downloaded from Apple using [App Store](https://apps.apple.com/br/app/macos-big-sur/id1526878132?mt=12) on a regular MacOS computer 
- Make a **USB** install disk _(the example below uses a USB device named USB and makes Big Sur installation disk)_:
```bash
sudo /Applications/Install\ macOS\ Big\ Sur.app/Contents/Resources/createinstallmedia --volume /Volumes/USB
```
- Mount the **EFI partition** of the **USB** disk using [MountEFI](https://github.com/corpnewt/MountEFI) utility and **copy the EFI folder** inside **/Volumes/EFI**
- **Boot** the target machine with **USB** disk you just made
- Using **Modified GRUB Shell** we must disable **CFG Lock** first with command below, but **note that hardcoded value is for F14a/b BIOS version of the Gigabyte z370N WIFI 1.0 motherboard, if you use another BIOS version or another motherboard model you need to recalculate this value** _(this command must run every time that BIOS is reflashed)_
```bash
setup_var_3 0x5A4 0x00
```
- Use **Clear NVRAM** and reboot to make a clean install
- Use **Disk Utility** to erase a **APFS GUI** volume and **install MacOS**
- Finish **normal** MacOS setup
- Install **App Store** applications, including **Xcode**
- Install [HomeBrew ](https://brew.sh) package management tool
- Run **Scripts** for install tools
- System Preferences &gt; Software Updates &gt; **Uncheck**
- System Preferences &gt; General &gt; Show Scrollbars &gt; **When scrolling**
- System Preferences &gt; Notifications &gt; **Check disable between 22h and 7h**
- System Preferences &gt; Monitors &gt; NightShift &gt; **Sunset to Sunrise**
- System Preferences &gt; Security &gt; Privacy &gt; **Check system locations service**
- System Preferences &gt; Security &gt; **activate Filevalt**
- Finder &gt; Preferences &gt; Start in **Documents** folder
- Finder &gt; Preferences &gt; Show **Home Folder**
- Finder &gt; View &gt; Show **Status Bar**
- Desktop &gt; Right click &gt; **Use Stacks**

## Post install
- On Brazil, to make **ABNT 2 keyboard** default, change language and keyboard layout in your **config.plist** inside **NVRAM** key section:
```xml
<key>prev-lang:kbd</key>
<string>pt-BR:128</string>
```
- Remove all **Tools** from menu _(if you need this tools again you can use your USB disk to boot)_. Edit your **config.plist** and find the following section:
```xml
<key>Tools</key>
<array>
	<dict>
		<key>Comment</key>
		<string>OpenShell.efi<string>
		<key>Auxiliary</key>
		<true/>
		<key>Enabled</key>
		<true/>
		<key>Arguments</key>
		<string></string>
		<key>Path</key>
		<string>OpenShell.efi<string>
		<key>Name</key>
		<string>OpenShell.efi<string>
		<key>RealPath</key>
		<false/>
		<key>TextMode</key>
		<false/>
	</dict>
	<dict>
		<key>Comment</key>
		<string>modGRUBShell.efi<string>
		<key>Auxiliary</key>
		<true/>
		<key>Enabled</key>
		<true/>
		<key>Arguments</key>
		<string></string>
		<key>Path</key>
		<string>modGRUBShell.efi<string>
		<key>Name</key>
		<string>modGRUBShell.efi<string>
		<key>RealPath</key>
		<false/>
		<key>TextMode</key>
		<false/>
	</dict>
</array>
```
Just **change it** to:
```xml
<key>Tools</key>
<array/>
```
After that, remove the **Tools folder** of your **EFI** volume.

- Disable **Reset NVRAM** option too:
```xml
<key>AllowNvramReset</key>
<false/>
```

- Disable **Boot Menu** to work like a real Mac:
```xml
<key>ShowPicker</key>
<false/>
```

## Notes

- Avoid [OSXFuse ](https://osxfuse.github.io) library _(useful if you plan to use VeraCrypt)_
- Avoid [NTFS-3g ](https://github.com/osxfuse/osxfuse/wiki/NTFS-3G) library _(it's old and bug, dificult to work with Big Sur, so don't waste your time)_
- Avoid [Intel Power Gadget ](https://software.intel.com/content/www/us/en/develop/articles/intel-power-gadget.html) app _(only needed to monitor CPU usage, for debug power management only)_
- Avoid [VirtualBox](https://www.virtualbox.org) app _(use VMWare Player or Parallels instead)_

## License

[MIT](https://choosealicense.com/licenses/mit/)
